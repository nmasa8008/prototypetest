"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getSecurities = void 0;
const lodash_1 = require("lodash");
const utils_1 = require("../utils");
const guards_1 = require("./guards");
function getSecurities(document, operationSecurity) {
    var _a;
    const opSchemesPairs = operationSecurity
        ? utils_1.mapToKeys(operationSecurity)
        : document.security
            ? utils_1.mapToKeys(document.security)
            : [];
    const flattenPairs = operationSecurity
        ? Object.assign({}, ...operationSecurity)
        : document.security
            ? Object.assign({}, ...document.security)
            : {};
    const definitions = (_a = document.components) === null || _a === void 0 ? void 0 : _a.securitySchemes;
    if (!lodash_1.isObject(definitions))
        return [];
    return opSchemesPairs.map(opSchemePair => opSchemePair
        .map(opScheme => {
        const definition = definitions[opScheme];
        if (guards_1.isSecurityScheme(definition) && definition.type === 'oauth2') {
            return Object.assign(Object.assign({}, definition), { flows: lodash_1.mapValues(definition.flows, (flow) => (Object.assign(Object.assign({}, flow), { scopes: lodash_1.pickBy(flow.scopes, (_val, key) => flattenPairs[opScheme].includes(key)) }))), key: opScheme });
        }
        return Object.assign(Object.assign({}, definition), { key: opScheme });
    })
        .filter(guards_1.isSecuritySchemeWithKey));
}
exports.getSecurities = getSecurities;
//# sourceMappingURL=accessors.js.map