"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getHttpOperationsFromSpec = void 0;
const operation_1 = require("@stoplight/http-spec/oas3/operation");
const operation_2 = require("@stoplight/http-spec/oas2/operation");
const operation_3 = require("@stoplight/http-spec/postman/operation");
const json_schema_ref_parser_1 = require("json-schema-ref-parser");
const lodash_1 = require("lodash");
async function getHttpOperationsFromSpec(specFilePathOrObject) {
    const result = await json_schema_ref_parser_1.dereference(specFilePathOrObject, { dereference: { circular: false } });
    if (isOpenAPI2(result))
        return operation_2.transformOas2Operations(result);
    if (isOpenAPI3(result))
        return operation_1.transformOas3Operations(result);
    if (isPostmanCollection(result))
        return operation_3.transformPostmanCollectionOperations(result);
    throw new Error('Unsupported document format');
}
exports.getHttpOperationsFromSpec = getHttpOperationsFromSpec;
function isOpenAPI2(document) {
    return lodash_1.get(document, 'swagger');
}
function isOpenAPI3(document) {
    return lodash_1.get(document, 'openapi');
}
function isPostmanCollection(document) {
    return Array.isArray(lodash_1.get(document, 'item')) && lodash_1.get(document, 'info.name');
}
